<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="../javascripts/sun.js"></script>
<script type="text/javascript" src="assert.js"></script>
<script type="text/javascript">
assert_equal(0, 'Sun.t(new Date(Date.UTC(1974, 11, 31, 0)));');

// p.207
one_minute = 1.0/(365.25*24*60);	// in unit of 365.25 days
target = 4.70773443;
assert_in_delta(target, one_minute, 'Sun.t(new Date(Date.UTC(1979, 9-1, 15, 12)));');

assert_in_delta(172.0505, 0.0001, 'Sun.lambda_for_t(4.70773443);');
// using 4.70773443 as input as written in the book p.207

assert_in_delta(31.77, 1.5, 'Sun.dT(new Date(Date.UTC(1960, 7-1, 1)));');

// p.141 - difference too much?
assert_in_delta(23.445787, 0.02, 'Sun.mean_obliquity(new Date(Date.UTC(1950, 0, 1, 0)));');

// p.141
mars = Sun.ecliptic_to_equatorial(
	{lambda: 113.89196, beta: 0.81631},
	new Date(Date.UTC(1950, 0, 1))
);
assert_in_delta(115.92538, 0.1, 'mars.alpha;');
assert_in_delta(22.13699, 2, 'mars.delta;');	// difference too much?

// p.26
one_minute = 1.0/(36525*24*60);	// in unit of 36525 days
assert_in_delta(0.78438056126, one_minute, 'Sun.tu(new Date(Date.UTC(1978, 6-1, 10, 0)));');

// p.27
assert_in_delta(257+59/60+40.41/3600, 1/3600, 'Sun.gst(new Date(Date.UTC(1978, 6-1, 10, 0)));');

// http://en.wikipedia.org/wiki/Equinox
// Northward equinox
t = new Date(Date.UTC(2013, 3-1, 20, 11, 2));
assert_in_delta(360, 1, 'Sun.lambda(t);');
sun = Sun.alphadelta(t);
assert_in_delta(0, 1, 'sun.alpha;');
assert_in_delta(0, 1, 'sun.delta;');
// Northern solstice
t = new Date(Date.UTC(2013, 6-1, 21, 5, 4));
assert_in_delta(90, 1, 'Sun.lambda(t);');
sun = Sun.alphadelta(t);
assert_in_delta(90, 1, 'sun.alpha;');
assert_in_delta(23.4, 1, 'sun.delta;');
// Southward equinox
t = new Date(Date.UTC(2013, 9-1, 22, 20, 44));
assert_in_delta(180, 1, 'Sun.lambda(t);');
sun = Sun.alphadelta(t);
assert_in_delta(180, 1, 'sun.alpha;');
assert_in_delta(0, 1, 'sun.delta;');
// Southern equinox
t = new Date(Date.UTC(2013, 12-1, 21, 17, 11));
assert_in_delta(270, 1, 'Sun.lambda(t);');
sun = Sun.alphadelta(t);
assert_in_delta(-90, 1, 'sun.alpha;');
assert_in_delta(-23.4, 1, 'sun.delta;');

t = new Date(Date.UTC(2013, 3-1, 20, 12, 0));	// Noon UTC
sun = Sun.latlng(t);
assert_in_delta(-360, 2, 'sun.lng;');
assert_in_delta(0, 2, 'sun.lat;');

t = new Date(Date.UTC(2013, 3-1, 20, 12+10, 0));	// Noon HST
sun = Sun.latlng(t);
assert_in_delta(-158, 10, 'sun.lng;');
assert_in_delta(0, 2, 'sun.lat;');
</script>
</head>
<body>
</body>
</html>
